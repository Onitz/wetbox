<!DOCTYPE html>
<html>
<head>
<style>
html,body{
  margin:0;
  padding:0;
  font-family:Arial,sans-serif;
  font-size:12px;
}
table{
  border-collapse:collapse;
}
td,th{
  width:15px;
  height:15px;
  border:1px solid #aaa;
  background-color:#fff;
}
tr:last-child, td:first-child{
  color:#aaa;
}
td:last-child {
  background-color:#aaa;
  border:none;
  border-radius:0 15px 0 0;
}
#bestpc{
  font-size:30px;
  font-weight:bold;
  padding:10px;
}
#besttiks{
  width:100%;
  min-height:300px;
}
button {
  float:right;
  width:200px;
  height:50px;
}
</style>
</head>
<body>
  <div id="bestpc"></div>
  <div>Number of tickets: <span id="ntix"></span></div>
  <button onClick="randomTry()">Try</button>
  <button onClick="randomAdd()">Add</button>
  <textarea id="besttiks"></textarea>
</body>
<script>
// N CHOOSE K ----------------------------------------------------------------------------------------- 
N = 35;
K = 7;

// -------- buy X tickets ----------------------------------------------------------------------------------------- 
state = null;
X = 30; //30 = $720
ITER = 30;

TRY_ITER=10000;
// 35c2 = 595
// 595/7c2 =  595 / 21 = 28.33 = 29 powerhits lower bound for full coverage (29*24 = AU$696)

tiks = [
];

function randomAdd() {
  tiks.push(quickpick());
  update();
  drawState();

  let bestpc = ((stateCoverage()/choose(N,2))*100).toFixed(2);
  document.getElementById('ntix').innerText = tiks.length;
  document.getElementById('bestpc').innerText = bestpc+'%';
  document.getElementById('besttiks').value = JSON.stringify(tiks);
}

function randomTry() {
  let bestCandidate=[];
  let bestScore=0;
  let bestPossibleScore=choose(K,2);

  for(let i=0;i<TRY_ITER;i++){
    let candidate = quickpick();
    candidate.sort((a,b)=>b-a); //reverse order lets us index by [1][2] (ie forward-ordered indexing on reverse-ordered ticket)
    let score = 0;
    score += state[candidate[0]][candidate[1]] < 1 ? 1 : 0;
    score += state[candidate[0]][candidate[2]] < 1 ? 1 : 0;
    score += state[candidate[0]][candidate[3]] < 1 ? 1 : 0;
    score += state[candidate[0]][candidate[4]] < 1 ? 1 : 0;
    score += state[candidate[0]][candidate[5]] < 1 ? 1 : 0;
    score += state[candidate[0]][candidate[6]] < 1 ? 1 : 0;

    score += state[candidate[1]][candidate[2]] < 1 ? 1 : 0;
    score += state[candidate[1]][candidate[3]] < 1 ? 1 : 0;
    score += state[candidate[1]][candidate[4]] < 1 ? 1 : 0;
    score += state[candidate[1]][candidate[5]] < 1 ? 1 : 0;
    score += state[candidate[1]][candidate[6]] < 1 ? 1 : 0;

    score += state[candidate[2]][candidate[3]] < 1 ? 1 : 0;
    score += state[candidate[2]][candidate[4]] < 1 ? 1 : 0;
    score += state[candidate[2]][candidate[5]] < 1 ? 1 : 0;
    score += state[candidate[2]][candidate[6]] < 1 ? 1 : 0;

    score += state[candidate[3]][candidate[4]] < 1 ? 1 : 0;
    score += state[candidate[3]][candidate[5]] < 1 ? 1 : 0;
    score += state[candidate[3]][candidate[6]] < 1 ? 1 : 0;

    score += state[candidate[4]][candidate[5]] < 1 ? 1 : 0;
    score += state[candidate[4]][candidate[6]] < 1 ? 1 : 0;

    score += state[candidate[5]][candidate[6]] < 1 ? 1 : 0;

    if(score > bestScore) {
      bestCandidate = candidate;
      bestScore = score;

      if(score===bestPossibleScore) {
        break;
      }
    }
  }

  tiks.push(bestCandidate);
  update();
  drawState();

  let bestpc = ((stateCoverage()/choose(N,2))*100).toFixed(2);
  document.getElementById('ntix').innerText = tiks.length;
  document.getElementById('bestpc').innerText = bestpc+'%';
  document.getElementById('besttiks').value = JSON.stringify(tiks);
}

function randomTryN(n) {
  tiks = [];
  for(let i=0;i<n;i++) {
    randomTry();
  }
}

// Spawn the table
(function proceduallyGenerateTriangle(n) {
  let table = document.createElement("table")
  table.setAttribute('cellpadding',0);
  table.setAttribute('cellspacing',0);
  document.body.prepend(table);

  // Row generation
  for(let i=0;i<(n+2);i++) {
    let row = document.createElement("tr");
    row.setAttribute('id','r'+i)
    table.appendChild(row);

    //r0 and rn+1 are horizontal label rows 
    if( i===0 || i===(n+1)) {
      for(let k=0;k<=(n+1);k++) {
        let cell = document.createElement("td");
        row.appendChild(cell);
        if(k!==0 && k!==(n+1) ) {
          let labl = document.createTextNode(k.toString().padStart(2,'0'));
          cell.appendChild(labl);
        } else if(i===0 && k===(n+1)) {
          cell.style.backgroundColor ='#fff';
        }
      }
      continue;
    }

    // Regular column generation
    for(let j=0;j<=i;j++) { 
      let cell = document.createElement("td");
      row.appendChild(cell);

      if(j===0) {
        let labl = document.createTextNode(i.toString().padStart(2,'0'));
        cell.appendChild(labl);
      }
    }
  }
})(N)


function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;
  while (0 !== currentIndex) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }
  return array;
}

function quickpick() {
  for (var a=[],i=0;i<N;++i) a[i]=i+1;
  a = shuffle(a);
  return a.slice(0,K);
}
console.log(quickpick());

function quickpickn(n) {
  tiks = [];
  for(let i=0;i<n;i++) {
    tiks[i] = quickpick();
  }
}

blankSlate = [
  [0],
  [0,0],
  [0,0,0],
  [0,0,0,0],
  [0,0,0,0,0],
  [0,0,0,0,0,0],
  [0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
  [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
]; //border of dataset should be all zeros (visually obvious if this cond is broken)

function resetState() {
  state = JSON.parse(JSON.stringify(blankSlate));
}
resetState();

let clashOfColors = [
  'black',
  '#0f0',
  'yellow',
  'orange',
  'red',
];

function computeState() {
  //state = JSON.parse(JSON.stringify(blankSlate)); //force refresh the state

  for(let i=0;i<tiks.length;i++) {
    let tik = tiks[i];
    tik.sort((a,b)=>a-b); //By Default it sorts alphabetically, so will return [11,12,8,9], dumb. add lambda to fix
    // console.log(tik);

    if(tik.length === K) { //tik.length > 1 && tik.length < 8) {
      let a = tik[0];
      let b = tik[1];
      let c = tik[2];
      let d = tik[3];
      let e = tik[4];
      let f = tik[5];
      let g = tik[6];

      if(!a || !b || !c || !d || !e || !f) {
        console.error('UH OH, ZERO TICKET ENTRY')
      }

      state[b][a]++;
      state[c][a]++;
      state[d][a]++;
      state[e][a]++;
      state[c][b]++;
      state[d][b]++;

      state[d][c]++;

      state[e][b]++;
      state[e][c]++;
      state[e][d]++;

      state[f][a]++;
      state[f][b]++;
      state[f][c]++;
      state[f][d]++;
      state[f][e]++;

      if(g) {
        state[g][a]++;
        state[g][b]++;
        state[g][c]++;
        state[g][d]++;
        state[g][e]++;
        state[g][f]++;
      }
    }
  }

}

function drawState() { //drawstate or countstate
  for(let i=0;i<(N+2);i++) { //row iterator
    for(let j=0;j<=i;j++) { //col iterator (init to zero to test lower bound)
      let val = state[i][j];
      let cel = document.getElementById(`r${i}`).children[j];
      cel.style.backgroundColor = clashOfColors[Math.min( val, clashOfColors.length - 1)];
    }
  }
}

function stateCoverage() {
  let ret = 0;
  let k=0;
  for(let i=1;i<(N+1);i++) { //row iterator
    for(let j=1;j<i;j++) { //col iterator (init to zero to test lower bound)
      if(state[i][j]>0) ret++;
      //else console.log('NO COVERAGE AT ',i,j,'(',state[i][j],')');
    }
  }
  //console.log('state coverage=',stateCoverage);
  //console.log('',ret,'/',choose(N,2),'=',(100*ret/choose(N,2)).toFixed(2),'%' );
  return ret;
}

function update() { 
  resetState();
  computeState();
}
update();

bestTiks = JSON.parse(JSON.stringify(tiks));
bestStateCoverage = stateCoverage();

for(let i=0;i<ITER;i++){
  // just randomly pick 30, no climbing // quickpickn(X);
  randomTryN(X);

  update();
  let sc = stateCoverage();
  if(sc > bestStateCoverage) { // we have a new beststate 
    console.log(stateCoverage(),'is better than',bestStateCoverage,'?')
    bestStateCoverage = sc;
    bestTiks = JSON.parse(JSON.stringify(tiks)); //deep copy
  }
}

console.log('-------best');
tiks=JSON.parse(JSON.stringify(bestTiks));
update();
bestpc = ((stateCoverage()/choose(N,2))*100).toFixed(2);
drawState();

document.getElementById('bestpc').innerText = bestpc+'%';
document.getElementById('ntix').innerText = bestTiks.length;
document.getElementById('besttiks').value = JSON.stringify(bestTiks);


//this time its 45 Choose 6 = 45/6*44/5*43/4*42/3*41/2*40/1 = 8 145 060
function choose(n, k) {
  let ret = 1;
  for(let i=1;i<=k;i++){
    ret*=(n-k+i)/i;
  }
  return ret;
}

/*
66 tickets is absolute minimum lower bound for sat 
aka 6C2/45C2 = 15/990 = 66


29 powerhits 
71.93
[[4,15,20,24,30,32,34],[4,9,17,20,25,30,34],[17,18,19,21,22,23,33],[3,6,7,16,23,26,27],[2,13,14,15,23,25,29],[10,13,17,19,24,27,33],[3,16,21,26,27,29,30],[2,6,10,24,30,33,35],[5,15,16,20,26,33,35],[1,3,7,11,12,27,28],[5,6,9,13,14,27,35],[1,9,10,15,19,31,35],[8,10,11,18,20,25,28],[3,4,9,14,22,28,32],[1,5,8,20,22,31,34],[2,5,16,22,28,34,35],[3,4,16,22,23,24,26],[3,13,23,24,25,31,34],[3,7,8,11,13,16,32],[16,17,22,26,31,33,34],[1,2,8,12,13,26,34],[4,5,6,11,20,22,23],[2,20,21,24,27,32,34],[7,9,14,19,20,23,26],[3,5,11,18,19,26,29],[8,10,14,15,21,25,35],[7,9,12,17,18,31,33],[7,10,17,22,25,29,35],[4,8,15,21,27,29,31]]


30 power (manulal hillclimber, 100x iters) 
80.67
[[2,3,4,13,19,25,32],[12,13,16,18,20,27,31],[3,8,17,26,29,34,35],[1,14,15,19,22,26,31],[10,11,22,25,28,33,34],[6,9,20,21,23,25,35],[2,11,15,16,17,23,29],[5,7,8,10,14,18,23],[6,7,17,20,22,30,32],[1,9,13,24,29,33,35],[2,5,9,12,27,28,35],[4,8,9,19,21,30,31],[3,14,15,18,27,30,33],[1,4,5,12,23,29,32],[2,10,12,14,17,21,24],[1,3,4,16,18,21,22],[11,21,23,24,26,27,28],[5,10,16,21,26,30,34],[3,7,12,15,19,24,28],[1,8,16,20,25,27,28],[4,5,6,11,15,33,35],[4,6,10,20,24,31,35],[2,7,9,17,25,26,31],[7,9,13,14,20,27,34],[11,12,18,26,27,32,34],[2,6,8,14,16,18,29],[2,13,23,26,31,33,34],[8,13,21,22,27,32,33],[6,10,19,27,30,34,35],[3,5,9,11,13,14,31]]

84.03 (1000x hillclimb iters)
[[16,17,26,30,31,33,35],[1,9,18,20,28,34,35],[4,6,15,17,27,32,34],[11,12,14,19,25,26,32],[3,7,8,16,18,21,23],[2,10,19,24,29,33,34],[1,4,13,22,23,25,31],[5,8,12,15,20,24,31],[6,9,10,11,21,22,33],[6,7,13,20,27,29,30],[9,14,17,23,24,28,30],[2,8,11,15,23,27,35],[2,5,6,16,22,26,28],[3,5,10,13,18,32,35],[1,3,8,10,14,15,30],[3,4,9,12,26,29,34],[4,7,14,19,20,21,35],[5,7,11,14,27,31,34],[9,15,16,19,25,28,29],[3,11,17,18,22,24,30],[1,2,21,24,27,30,32],[1,5,7,17,19,21,26],[6,12,13,18,19,23,33],[2,3,4,5,8,25,33],[8,20,22,23,26,28,32],[7,9,10,24,25,26,27],[4,10,13,14,16,27,28],[1,11,16,20,29,31,32],[2,7,12,15,22,26,28],[3,6,14,20,25,28,31]]

85.21 (10000x hillclimb iters)
[[1,5,11,19,23,27,31],[1,4,13,14,18,30,35],[11,20,24,26,32,33,35],[3,10,16,17,21,24,29],[3,6,8,9,14,20,34],[7,21,25,27,28,33,34],[2,4,7,11,12,22,29],[2,14,15,17,19,25,26],[2,9,10,23,28,31,32],[5,8,12,13,15,21,30],[1,6,15,16,22,28,35],[12,16,18,22,26,31,34],[5,6,7,10,17,20,30],[8,19,22,24,27,30,32],[3,4,5,9,18,22,25],[6,15,18,20,23,29,33],[4,8,13,17,28,31,33],[1,3,7,12,13,23,32],[2,3,6,13,21,26,27],[9,12,13,19,24,25,29],[7,8,10,16,19,25,35],[3,9,11,26,28,29,30],[1,2,5,14,16,30,33],[4,14,15,24,27,32,34],[4,6,19,20,21,31,35],[1,10,14,17,22,23,34],[9,11,12,17,21,27,35],[5,8,10,11,26,29,34],[7,9,11,14,15,16,31],[2,8,18,19,21,23,24]]

86.05 (10k hci)
[[1,7,18,19,22,27,33],[5,11,23,26,29,32,35],[4,10,15,22,28,31,32],[8,9,12,14,17,25,32],[9,13,16,22,24,26,34],[4,6,20,25,30,33,35],[2,3,15,17,19,21,29],[2,6,8,11,24,27,31],[3,4,5,8,13,14,18],[6,10,12,16,18,21,23],[1,2,5,12,30,31,34],[7,14,20,24,28,29,34],[13,17,19,23,27,28,30],[3,7,8,10,21,26,30],[3,16,25,27,28,31,35],[1,10,11,14,15,16,20],[1,10,13,21,24,32,33],[10,15,17,18,24,34,35],[5,6,7,9,11,17,33],[2,4,12,20,26,27,28],[2,9,10,18,22,25,29],[1,4,8,9,19,20,23],[7,12,13,15,24,25,35],[2,7,14,23,24,31,33],[5,10,11,19,21,25,34],[3,8,12,20,22,29,33],[1,6,14,17,22,25,26],[3,6,11,22,30,32,34],[9,15,21,26,27,29,31],[2,7,14,16,19,32,35]]

86.55 (30 x upTo30 x 10k hci)
[[2,4,8,17,22,23,24],[10,12,14,25,29,31,34],[7,15,16,20,26,33,35],[3,10,13,18,21,24,27],[1,5,11,15,27,30,32],[4,6,14,19,20,21,32],[11,13,17,19,28,33,34],[5,6,18,23,26,28,31],[7,9,18,22,28,29,32],[1,9,16,19,24,30,31],[2,3,5,12,19,29,35],[1,4,7,12,13,25,30],[6,9,16,17,25,27,35],[5,8,9,11,13,14,16],[2,3,21,22,26,30,34],[1,2,6,10,13,22,33],[3,9,12,21,23,25,33],[6,7,8,15,24,29,34],[1,8,12,17,20,27,28],[7,10,11,19,23,26,27],[14,18,24,28,30,33,35],[3,4,15,17,26,31,32],[2,11,12,18,20,24,25],[2,4,16,18,27,32,34],[8,13,20,23,31,32,35],[1,14,16,17,23,26,29],[4,5,10,17,21,30,35],[3,11,15,16,21,22,28],[4,8,11,21,29,31,33],[5,7,22,25,27,31,34]]
*/
</script>
</html>